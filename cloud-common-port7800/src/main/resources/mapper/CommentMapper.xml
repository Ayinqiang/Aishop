<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.base.common.dao.StoreCommentDao">

    <resultMap id="StoreCommentMap" type="com.base.pojo.StoreComment">
        <id column="id" property="id"></id>
        <result column="uid" property="uid"></result>
        <result column="comment_id" property="commentId"></result>
        <result column="store_id" property="storeId"></result>
        <result column="parent_id" property="parentId"></result>
        <result column="comment_text" property="commentText"></result>
        <result column="created_time" property="createTime"></result>
        <collection column="comment_id" property="storeComment"
                    javaType="com.base.pojo.StoreComment" select="getStoreCommentByParentId">
        </collection>
        <collection column="uid" property="userData" javaType="com.base.pojo.UserData" select="getUserData">

        </collection>
    </resultMap>

    <select id="getStoreCommentById" resultMap="StoreCommentMap">
        SELECT * FROM store_comment WHERE store_id = #{storeId} AND parent_id is null
    </select>

    <select id="getStoreCommentByParentId" resultMap="StoreCommentMap">
        SELECT * FROM store_comment WHERE  parent_id = #{parentId}
    </select>

    <select id="getUserData" resultType="com.base.pojo.UserData">
        select id, uid, sex, authorities, name, sign, avatar, email, phone FROM  user_data WHERE uid = #{uid}
    </select>

    <insert id="insertStoreComment" parameterType="com.base.pojo.StoreComment">
        INSERT INTO store_comment(uid, comment_id, store_id, parent_id, comment_text, created_time)
         values (#{StoreComment.uid},
         #{StoreComment.commentId},
         #{StoreComment.storeId},
         #{StoreComment.parentId},
         #{StoreComment.commentText},
         #{StoreComment.createTime});
    </insert>


</mapper>
